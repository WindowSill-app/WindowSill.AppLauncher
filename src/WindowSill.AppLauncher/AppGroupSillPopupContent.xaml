<?xml version="1.0" encoding="utf-8" ?>
<api:SillPopupContent
    x:Class="WindowSill.AppLauncher.AppGroupSillPopupContent"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:api="using:WindowSill.API"
    xmlns:appinfo="using:WindowSill.AppLauncher.Core.AppInfo"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="using:WindowSill.AppLauncher"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="using:CommunityToolkit.WinUI"
    MinWidth="220"
    MinHeight="32"
    MaxWidth="548"
    MaxHeight="756"
    mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>

        <TextBlock
            Grid.Row="0"
            Grid.Column="0"
            Margin="16,12,12,12"
            Style="{ThemeResource SubtitleTextBlockStyle}"
            Text="{x:Bind AppGroup.GroupName}"
            TextWrapping="NoWrap" />
        <StackPanel
            Grid.Row="0"
            Grid.Column="1"
            Margin="12"
            Orientation="Horizontal"
            Spacing="8">
            <Button
                Height="32"
                Background="Transparent"
                BorderBrush="Transparent"
                Click="LaunchAllButton_Click">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon
                        VerticalAlignment="Center"
                        FontFamily="{StaticResource SegoeFluentIcons}"
                        FontSize="12"
                        Glyph="&#xE8A7;" />
                    <TextBlock api:Uids.Uid="/WindowSill.AppLauncher/AppGroupSillPopupContent/LaunchAll" />
                </StackPanel>
            </Button>
            <Button
                Width="32"
                Height="32"
                Padding="0"
                api:Uids.Uid="/WindowSill.AppLauncher/AppGroupSillPopupContent/Edit"
                Background="Transparent"
                BorderBrush="Transparent"
                Click="EditButton_Click">
                <FontIcon
                    VerticalAlignment="Center"
                    FontFamily="{StaticResource SegoeFluentIcons}"
                    FontSize="12"
                    Glyph="&#xE70F;" />
            </Button>
        </StackPanel>

        <ListView
            Grid.Row="1"
            Grid.ColumnSpan="2"
            HorizontalAlignment="Stretch"
            HorizontalContentAlignment="Stretch"
            IsItemClickEnabled="True"
            ItemClick="ListView_ItemClick"
            ItemsSource="{x:Bind AppGroup.Items}"
            SelectionMode="None">
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="appinfo:AppInfo">
                    <Grid
                        Height="48"
                        HorizontalAlignment="Stretch"
                        ColumnSpacing="12">
                        <Grid.ContextFlyout>
                            <MenuFlyout>
                                <MenuFlyoutItem
                                    api:Uids.Uid="/WindowSill.AppLauncher/AppGroupSillPopupContent/Open"
                                    Click="LaunchMenuFlyoutItem_Click"
                                    Icon="{ui:FontIcon FontFamily={StaticResource SegoeFluentIcons},
                                                       Glyph=&#xE8A7;}"
                                    Tag="{Binding}" />
                                <MenuFlyoutItem
                                    api:Uids.Uid="/WindowSill.AppLauncher/AppGroupSillPopupContent/RunAsAdmin"
                                    Click="RunAsAdminMenuFlyoutItem_Click"
                                    Icon="{ui:FontIcon FontFamily={StaticResource SegoeFluentIcons},
                                                       Glyph=&#xE7EF;}"
                                    IsEnabled="{x:Bind local:AppGroupSillPopupContent.IsExeOrShortcut((appinfo:AppInfo)), Mode=OneTime}"
                                    Tag="{Binding}" />
                                <MenuFlyoutItem
                                    api:Uids.Uid="/WindowSill.AppLauncher/AppGroupSillPopupContent/OpenFileLocation"
                                    Click="OpenLocationMenuFlyoutItem_Click"
                                    Icon="{ui:FontIcon FontFamily={StaticResource SegoeFluentIcons},
                                                       Glyph=&#xED43;}"
                                    IsEnabled="{x:Bind local:AppGroupSillPopupContent.IsNotUwpApp((appinfo:AppInfo)), Mode=OneTime}"
                                    Tag="{Binding}" />
                            </MenuFlyout>
                        </Grid.ContextFlyout>

                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <Image
                            Grid.Column="0"
                            Width="24"
                            Height="24"
                            VerticalAlignment="Center"
                            Source="{x:Bind AppIcon.Result, Mode=OneWay}" />

                        <TextBlock
                            Grid.Column="1"
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Center"
                            Text="{x:Bind DisplayName, Mode=OneWay}"
                            TextTrimming="CharacterEllipsis" />
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>
    </Grid>
</api:SillPopupContent>
